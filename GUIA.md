# Gu√≠a de Implementaci√≥n de NextAuth.js en este Proyecto

Aqu√≠ est√°n los pasos detallados para implementar la autenticaci√≥n con NextAuth.js en la estructura de nuestro proyecto actual, que utiliza Next.js con App Router y TypeScript.

---

## üß© PASO 1 ‚Äî Instalar NextAuth

Abre tu terminal y ejecuta el siguiente comando para a√±adir NextAuth al proyecto:

```bash
npm install next-auth
```

---

## üß© PASO 2 ‚Äî Crear la Ruta de Autenticaci√≥n

Dado que estamos usando App Router, necesitas crear un "Route Handler". Crea la siguiente estructura de carpetas y el archivo:

`app/api/auth/[...nextauth]/route.ts`

Dentro de este nuevo archivo `route.ts`, pega el siguiente c√≥digo:

```typescript
import NextAuth from "next-auth"
import GithubProvider from "next-auth/providers/github"
import { AuthOptions } from "next-auth"

export const authOptions: AuthOptions = {
  // Configura uno o m√°s proveedores de autenticaci√≥n
  providers: [
    GithubProvider({
      clientId: process.env.GITHUB_ID as string,
      clientSecret: process.env.GITHUB_SECRET as string,
    }),
    // ...puedes a√±adir m√°s proveedores aqu√≠
  ],
}

const handler = NextAuth(authOptions)

export { handler as GET, handler as POST }
```

**Nota:** Usamos `as string` para asegurar a TypeScript que estas variables de entorno existir√°n.

---

## üß© PASO 3 ‚Äî Configurar Variables de Entorno

Crea un archivo llamado `.env.local` en la ra√≠z del proyecto (si no existe) y a√±ade las siguientes variables. Reemplaza los valores de ejemplo con tus credenciales de GitHub.

```
# Credenciales de GitHub OAuth App
GITHUB_ID=TU_CLIENT_ID_DE_GITHUB
GITHUB_SECRET=TU_CLIENT_SECRET_DE_GITHUB

# Secreto para NextAuth
# Puedes generar uno ejecutando: openssl rand -hex 32 en tu terminal
NEXTAUTH_SECRET=UN_SECRETO_SUPER_SEGURO_Y_LARGO

# La URL de tu aplicaci√≥n en desarrollo
NEXTAUTH_URL=http://localhost:3000
```

**¬°Importante!** No olvides reiniciar tu servidor de desarrollo despu√©s de modificar este archivo.

---

## üß© PASO 4 ‚Äî Crear el `SessionProvider`

El `SessionProvider` de NextAuth requiere un contexto de cliente (`"use client"`), pero el layout principal (`app/layout.tsx`) es un Server Component. Para integrarlos, crearemos un componente contenedor.

1.  **Crea el componente `Providers`:**

    Crea un nuevo archivo en `src/components/Providers.tsx` y a√±ade el siguiente c√≥digo:

    ```tsx
    "use client"

    import { SessionProvider } from "next-auth/react"
    import React from "react"

    interface Props {
        children: React.ReactNode;
    }

    export default function Providers({ children }: Props) {
      return <SessionProvider>{children}</SessionProvider>
    }
    ```

2.  **Actualiza el `RootLayout`:**

    Ahora, envuelve el contenido de tu layout principal en `app/layout.tsx` con el componente `Providers` que acabas de crear. El archivo deber√≠a quedar similar a esto:

    ```tsx
    // app/layout.tsx
    import type { Metadata } from "next";
    import { Inter } from "next/font/google";
    import "./globals.css";
    import Providers from "@/src/components/Providers"; // o la ruta correcta a tu componente

    const inter = Inter({ subsets: ["latin"] });

    export const metadata: Metadata = {
      title: "Create Next App",
      description: "Generated by create next app",
    };

    export default function RootLayout({
      children,
    }: Readonly<{
      children: React.ReactNode;
    }>) {
      return (
        <html lang="es">
          <body className={inter.className}>
            <Providers>
              {children}
            </Providers>
          </body>
        </html>
      );
    }
    ```

---

## üß© PASO 5 ‚Äî Crear y Usar un Bot√≥n de Login

Puedes crear un componente cliente para gestionar el inicio y cierre de sesi√≥n.

1.  **Crea el componente `LoginButton`:**

    Crea el archivo `src/components/LoginButton.tsx`:

    ```tsx
    "use client"

    import { useSession, signIn, signOut } from "next-auth/react"

    export default function LoginButton() {
      const { data: session } = useSession()

      if (session) {
        return (
          <>
            Logueado como {session.user?.email} <br />
            <button onClick={() => signOut()}>Cerrar sesi√≥n</button>
          </>
        )
      }
      return (
        <>
          No est√°s logueado <br />
          <button onClick={() => signIn("github")}>Iniciar sesi√≥n con GitHub</button>
        </>
      )
    }
    ```

2.  **A√±ade el bot√≥n a una p√°gina:**

    Por ejemplo, para usarlo en tu p√°gina principal `app/page.tsx`:

    ```tsx
    import LoginButton from '../src/components/LoginButton' // Ajusta la ruta

    export default function HomePage() {
      return (
        <main>
          <h1>Bienvenido a la Tienda</h1>
          <LoginButton />
          {/* ...otro contenido de tu p√°gina */}
        </main>
      )
    }
    ```

---

## üß© PASO 6 ‚Äî Proteger P√°ginas (Server Side)

Para proteger rutas y redirigir a los usuarios no autenticados, puedes usar `getServerSession` en tus Server Components (p√°ginas).

Por ejemplo, para proteger una p√°gina hipot√©tica de "Dashboard":

```tsx
// app/dashboard/page.tsx
import { getServerSession } from "next-auth/next"
import { authOptions } from "../api/auth/[...nextauth]/route"
import { redirect } from "next/navigation"

export default async function DashboardPage() {
  const session = await getServerSession(authOptions)

  if (!session) {
    // Redirige al inicio si no hay sesi√≥n
    redirect("/")
  }

  return (
    <div>
      <h1>Panel de Control</h1>
      <p>Bienvenido, {session.user?.name}. Este es contenido protegido.</p>
    </div>
  )
}
```

Con estos pasos, tendr√°s NextAuth configurado en tu proyecto siguiendo las convenciones de Next.js App Router y TypeScript.
